{
  "rules": {
    ".read": "auth != null && root.child('admins').child(auth.uid).exists()",
    ".write": "auth != null && root.child('admins').child(auth.uid).exists()",

    "admins": {
      ".read": "auth != null && root.child('admins').child(auth.uid).exists()",
      ".write": "auth != null && root.child('admins').child(auth.uid).exists()",
      "$uid": {
        ".read": "auth != null && $uid === auth.uid",
        ".validate": "newData.isBoolean()"
      }
    },

    "teachers": {
      ".read": "auth != null",
      ".write": "auth != null && root.child('admins').child(auth.uid).exists()",
      "$uid": {
        ".validate": "newData.isString()"
      }
    },

    "students": {
      ".read": "auth != null",
      ".write": "auth != null && (root.child('admins').child(auth.uid).exists() || root.child('teachers').child(auth.uid).exists())",
      "$uid": {
        "consultation_timetable": {
          ".read": "auth != null && $uid === auth.uid",
          ".write": "auth != null && $uid === auth.uid"
        }
      }
    },

    "predmety": {
      ".read": "auth != null",
      "$subjectKey": {
        ".write": "auth != null && root.child('admins').child(auth.uid).exists()",
        "timetable": {
          "$entryKey": {
            "classroom": {
              ".write": "auth != null && root.child('teachers').child(auth.uid).exists() && data.parent().exists()"
            },
            "note": {
              ".write": "auth != null && root.child('teachers').child(auth.uid).exists() && data.parent().exists()"
            }
          }
        }
      }
    },

    "hodnotenia": {
      ".write": "auth != null && (root.child('admins').child(auth.uid).exists() || root.child('teachers').child(auth.uid).exists())",
      "$year": {
        "$semester": {
          "$subjectKey": {
            ".read": "auth != null && (root.child('admins').child(auth.uid).exists() || root.child('teachers').child(auth.uid).exists())",
            "$studentUid": {
              ".read": "auth != null && $studentUid === auth.uid"
            }
          }
        }
      }
    },

    "pritomnost": {
      ".write": "auth != null && (root.child('admins').child(auth.uid).exists() || root.child('teachers').child(auth.uid).exists())",
      "$year": {
        "$semester": {
          "$subjectKey": {
            ".read": "auth != null && (root.child('admins').child(auth.uid).exists() || root.child('teachers').child(auth.uid).exists())",
            "qr_code": {
              ".read": "auth != null",
              ".write": "auth != null && !newData.exists()"
            },
            "qr_last_scan": {
              ".write": "auth != null",
              ".validate": "newData.hasChildren(['uid', 'name', 'time']) && newData.child('uid').val() === auth.uid"
            },
            "qr_fail": {
              ".write": "auth != null",
              ".validate": "newData.hasChildren(['name', 'reason', 'time'])"
            },
            "$studentUid": {
              ".read": "auth != null && $studentUid === auth.uid"
            }
          }
        }
      }
    },

    "school_years": {
      ".read": "auth != null",
      ".write": "auth != null && (root.child('admins').child(auth.uid).exists() || root.child('teachers').child(auth.uid).exists())",
      "$yearKey": {
        "predmety": {
          "$subjectKey": {
            ".write": "auth != null && (root.child('admins').child(auth.uid).exists() || root.child('teachers').child(auth.uid).exists())"
          }
        }
      }
    },

    "days_off": {
      ".read": "auth != null",
      "$teacherUid": {
        ".write": "auth != null && ($teacherUid === auth.uid || root.child('admins').child(auth.uid).exists())"
      }
    },

    "consultation_bookings": {
      ".read": "auth != null",
      "$subjectKey": {
        ".write": "auth != null",
        "$bookingKey": {
          ".write": "auth != null && (!data.exists() || data.child('studentUid').val() === auth.uid || root.child('admins').child(auth.uid).exists() || root.child('teachers').child(auth.uid).exists())"
        }
      }
    },

    "notifications": {
      "$uid": {
        ".read": "auth != null && $uid === auth.uid",
        ".write": "auth != null"
      }
    },

    "settings": {
      ".read": "auth != null",
      ".write": "auth != null && root.child('admins').child(auth.uid).exists()",
      "allowed_domains": {
        ".read": true
      }
    }
  }
}
